<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Actualités | Institution Éducative</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            updateDoc, 
            deleteDoc, 
            doc, 
            query, 
            orderBy, 
            onSnapshot, 
            serverTimestamp,
            getDoc 
        } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
        import { 
            getAuth, 
            onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";

  const firebaseConfig = {
  apiKey: "AIzaSyBVOYsbpi0hpOnaJVZ5wtTnQGdZFUJjdyY",
  authDomain: "ifept-ba289.firebaseapp.com",
  projectId: "ifept-ba289",
  storageBucket: "ifept-ba289.firebasestorage.app",
  messagingSenderId: "1080157509438",
  appId: "1:1080157509438:web:e20bbbfd2d8ac5bb81be6f",
  measurementId: "G-PGP98RVV0S"
};

        // Initialiser Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // Rendre les variables globales
        window.firebaseApp = app;
        window.db = db;
        window.auth = auth;
        window.firebaseModules = {
            collection, addDoc, updateDoc, deleteDoc, doc, query, orderBy, onSnapshot, serverTimestamp, getDoc
        };
    </script>
    
    <style>
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .truncate-2-lines {
            display: -webkit-box;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
   

    <main class="container mx-auto px-4 py-8">
        <!-- En-tête du dashboard -->
        <div class="mb-10">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-3">
                <i class="fas fa-newspaper text-blue-600 mr-3"></i>
                Gestion des Actualités
            </h1>
            <p class="text-gray-600">
                Gérez les articles et publications de l'institution éducative
            </p>
        </div>

        <!-- Messages de feedback -->
        <div id="feedback-message" class="hidden mb-6 p-4 rounded-lg"></div>

        <!-- Section formulaire -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Formulaire d'ajout/modification -->
            <div class="lg:col-span-1 bg-white rounded-xl shadow-md p-6 h-fit">
                <h2 class="text-xl font-bold text-gray-800 mb-6 pb-3 border-b">
                    <i class="fas fa-edit mr-2"></i>
                    <span id="form-title">Ajouter un article</span>
                </h2>
                
                <form id="post-form" class="space-y-5">
                    <input type="hidden" id="post-id" value="">
                    
                    <!-- Type d'article -->
                    <div>
                        <label class="block text-gray-700 text-sm font-medium mb-2" for="type">
                            Type de média <span class="text-red-500">*</span>
                        </label>
                        <div class="flex space-x-4">
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="type" value="image" 
                                       class="mr-2 text-blue-600 focus:ring-blue-500" 
                                       id="type-image" checked>
                                <span class="text-gray-700">
                                    <i class="fas fa-image mr-1"></i> Image
                                </span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="type" value="video" 
                                       class="mr-2 text-blue-600 focus:ring-blue-500" 
                                       id="type-video">
                                <span class="text-gray-700">
                                    <i class="fas fa-video mr-1"></i> Vidéo
                                </span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Nom du fichier média -->
                    <div>
                        <label class="block text-gray-700 text-sm font-medium mb-2" for="media">
                            Nom du fichier média <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fas fa-file text-gray-400"></i>
                            </div>
                            <input type="text" id="media" name="media" required
                                   class="pl-10 w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                                   placeholder="ex: photo.jpg ou video.mp4">
                        </div>
                        <p class="text-xs text-gray-500 mt-2">
                            Le fichier doit déjà être présent à la racine du projet
                        </p>
                    </div>
                    
                    <!-- Description -->
                    <div>
                        <label class="block text-gray-700 text-sm font-medium mb-2" for="description">
                            Description <span class="text-red-500">*</span>
                        </label>
                        <textarea id="description" name="description" rows="5" required
                                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                                  placeholder="Description de l'article..."></textarea>
                    </div>
                    
                    <!-- Boutons d'action -->
                    <div class="pt-2 flex space-x-3">
                        <button type="submit" id="submit-btn"
                                class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg transition duration-200 flex items-center justify-center">
                            <i class="fas fa-paper-plane mr-2"></i>
                            <span id="submit-btn-text">Publier l'article</span>
                        </button>
                        
                        <button type="button" id="cancel-edit-btn"
                                class="hidden bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-3 px-4 rounded-lg transition duration-200 flex items-center justify-center">
                            <i class="fas fa-times mr-2"></i>
                            Annuler
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Liste des articles -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-xl shadow-md overflow-hidden">
                    <div class="px-6 py-5 border-b border-gray-200">
                        <div class="flex justify-between items-center">
                            <h2 class="text-xl font-bold text-gray-800">
                                <i class="fas fa-list mr-2"></i>
                                Articles publiés
                            </h2>
                            <div class="text-sm text-gray-500">
                                <span id="posts-count">0</span> article(s)
                            </div>
                        </div>
                    </div>
                    
                    <!-- Liste des articles -->
                    <div id="posts-list" class="divide-y divide-gray-100">
                        <!-- Les articles seront chargés ici dynamiquement -->
                        <div class="p-8 text-center text-gray-500">
                            <i class="fas fa-spinner fa-spin text-2xl mb-3"></i>
                            <p>Chargement des articles...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer dynamique -->
 <div id="navBulleContainer" class="fixed z-50">
  <!-- Bulle principale -->
  <button 
    id="navBulleBtn" 
    class="flex items-center justify-center w-14 h-14 rounded-full shadow-2xl bg-gradient-to-br from-blue-600 to-indigo-700 hover:from-blue-700 hover:to-indigo-800 text-white transition-all duration-300 active:scale-95 focus:outline-none focus:ring-4 focus:ring-blue-300/50"
    aria-label="Ouvrir le menu de navigation"
  >
    <i id="navBulleIcon" class="fas fa-compass text-xl"></i>
  </button>
  
  <!-- Fenêtre de navigation -->
  <div 
    id="navBulleWindow" 
    class="absolute bottom-16 right-0 w-72 bg-white rounded-2xl shadow-2xl p-4 transform -translate-y-2 opacity-0 invisible transition-all duration-300"
  >
    <!-- En-tête de la fenêtre -->
    <div class="flex items-center justify-between mb-4 pb-3 border-b border-gray-100">
      <h2 class="text-lg font-semibold text-gray-800">Navigation rapide</h2>
      <button 
        id="navBulleCloseBtn" 
        class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 text-gray-500 hover:text-gray-700 transition-colors"
        aria-label="Fermer le menu"
      >
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <!-- Liste des liens -->
    <ul class="space-y-2" id="navBulleLinks">
      <!-- Les liens seront injectés par JavaScript -->
    </ul>
    
    <!-- Indicateur de position (flèche) -->
    <div class="absolute -bottom-2 right-6 w-4 h-4 bg-white transform rotate-45"></div>
  </div>
</div>

<script>
// Configuration unique pour éviter les conflits
const navBulleConfig = {
  containerId: 'navBulleContainer',
  buttonId: 'navBulleBtn',
  windowId: 'navBulleWindow',
  closeButtonId: 'navBulleCloseBtn',
  linksContainerId: 'navBulleLinks',
  iconId: 'navBulleIcon',
  isOpen: false,
  isDragging: false,
  startX: 0,
  startY: 0,
  initialX: 0,
  initialY: 0,
  touchStartTime: 0,
  touchMoved: false,
  
  // Liens de navigation
  navLinks: [
    {
      id: 'navLinkAccueil',
      title: 'Dashboard Accueil',
      url: 'dashacceuil.html',
      icon: 'fas fa-home',
      color: 'text-blue-600'
    },
    {
      id: 'navLinkActualites',
      title: 'Dashboard Actualités',
      url: 'dashacctualites.html',
      icon: 'fas fa-newspaper',
      color: 'text-green-600'
    },
    {
      id: 'navLinkApropos',
      title: 'Dashboard À propos',
      url: 'dashapropo.html',
      icon: 'fas fa-info-circle',
      color: 'text-purple-600'
    },
    {
      id: 'navLinkCours',
      title: 'Dashboard Cours',
      url: 'dashboardcours.html',
      icon: 'fas fa-book-open',
      color: 'text-amber-600'
    },
    {
      id: 'navLinkContact',
      title: 'Dashboard Contact',
      url: 'dashcontact.html',
      icon: 'fas fa-envelope',
      color: 'text-red-600'
    },
    {
      id: 'navLinkSoumissions',
      title: 'Dashboard Soumissions',
      url: 'dashboardsoumissions.html',
      icon: 'fas fa-paper-plane',
      color: 'text-indigo-600'
    }
  ],
  
  // Initialisation
  init: function() {
    this.setupElements();
    this.renderLinks();
    this.setupEventListeners();
    this.positionBulleOnLoad();
  },
  
  // Configuration des éléments DOM
  setupElements: function() {
    this.container = document.getElementById(this.containerId);
    this.button = document.getElementById(this.buttonId);
    this.window = document.getElementById(this.windowId);
    this.closeButton = document.getElementById(this.closeButtonId);
    this.linksContainer = document.getElementById(this.linksContainerId);
    this.icon = document.getElementById(this.iconId);
  },
  
  // Rendu des liens de navigation
  renderLinks: function() {
    this.linksContainer.innerHTML = '';
    
    this.navLinks.forEach(link => {
      const li = document.createElement('li');
      li.innerHTML = `
        <a 
          href="${link.url}" 
          id="${link.id}"
          class="flex items-center p-3 rounded-xl hover:bg-blue-50 transition-colors group"
        >
          <div class="flex items-center justify-center w-10 h-10 rounded-lg ${link.color} bg-opacity-10 group-hover:bg-opacity-20 mr-3">
            <i class="${link.icon}"></i>
          </div>
          <span class="font-medium text-gray-800">${link.title}</span>
        </a>
      `;
      this.linksContainer.appendChild(li);
    });
  },
  
  // Configuration des écouteurs d'événements
  setupEventListeners: function() {
    // Clic sur la bulle (ouvrir/fermer) - pour desktop
    this.button.addEventListener('click', (e) => {
      // Vérifier si ce n'était pas un drag
      if (!this.isDragging && !this.touchMoved) {
        e.stopPropagation();
        this.toggleWindow();
      }
      this.touchMoved = false;
    });
    
    // Clic sur le bouton de fermeture
    this.closeButton.addEventListener('click', (e) => {
      e.stopPropagation();
      this.closeWindow();
    });
    
    // Fermer la fenêtre en cliquant à l'extérieur
    document.addEventListener('click', (e) => {
      if (this.isOpen && !this.window.contains(e.target) && !this.button.contains(e.target)) {
        this.closeWindow();
      }
    });
    
    // Gestion du déplacement sur desktop (drag)
    this.button.addEventListener('mousedown', this.startDrag.bind(this));
    document.addEventListener('mousemove', this.drag.bind(this));
    document.addEventListener('mouseup', this.stopDrag.bind(this));
    
    // Gestion des événements tactiles pour mobile - APPROCHE SIMPLIFIÉE
    this.button.addEventListener('touchstart', this.handleTouchStart.bind(this), { passive: false });
    this.button.addEventListener('touchmove', this.handleTouchMove.bind(this), { passive: false });
    this.button.addEventListener('touchend', this.handleTouchEnd.bind(this), { passive: false });
    
    // Fermer la fenêtre avec la touche Échap
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && this.isOpen) {
        this.closeWindow();
      }
    });
    
    // Ajuster la position lors du redimensionnement
    window.addEventListener('resize', this.adjustPositionOnResize.bind(this));
  },
  
  // Gestion du touchstart (mobile)
  handleTouchStart: function(e) {
    if (e.touches.length !== 1) return;
    
    e.preventDefault();
    e.stopPropagation();
    
    const touch = e.touches[0];
    this.startX = touch.clientX;
    this.startY = touch.clientY;
    this.initialX = this.container.offsetLeft;
    this.initialY = this.container.offsetTop;
    this.touchStartTime = Date.now();
    this.touchMoved = false;
    this.isDragging = false;
    
    // Timer pour détecter un appui long (drag)
    this.dragTimer = setTimeout(() => {
      this.isDragging = true;
      this.button.classList.add('cursor-grabbing', 'scale-105');
    }, 300);
  },
  
  // Gestion du touchmove (mobile)
  handleTouchMove: function(e) {
    if (e.touches.length !== 1) return;
    
    e.preventDefault();
    e.stopPropagation();
    
    const touch = e.touches[0];
    const deltaX = touch.clientX - this.startX;
    const deltaY = touch.clientY - this.startY;
    
    // Si le mouvement est suffisant, c'est un drag
    if (Math.abs(deltaX) > 10 || Math.abs(deltaY) > 10) {
      this.touchMoved = true;
      clearTimeout(this.dragTimer);
      
      // Si ce n'était pas déjà un drag, le devenir
      if (!this.isDragging) {
        this.isDragging = true;
        this.button.classList.add('cursor-grabbing', 'scale-105');
      }
      
      // Calculer la nouvelle position
      let newX = this.initialX + deltaX;
      let newY = this.initialY + deltaY;
      
      // Limites de la fenêtre
      const windowWidth = window.innerWidth;
      const windowHeight = window.innerHeight;
      const buttonSize = 56; // w-14 = 56px
      
      // S'assurer que la bulle reste dans les limites
      newX = Math.max(0, Math.min(newX, windowWidth - buttonSize));
      newY = Math.max(0, Math.min(newY, windowHeight - buttonSize));
      
      // Appliquer la nouvelle position
      this.container.style.left = `${newX}px`;
      this.container.style.top = `${newY}px`;
      this.container.style.right = 'auto';
      this.container.style.bottom = 'auto';
      
      // Fermer la fenêtre si elle est ouverte pendant le drag
      if (this.isOpen) {
        this.closeWindow();
      }
    }
  },
  
  // Gestion du touchend (mobile)
  handleTouchEnd: function(e) {
    e.preventDefault();
    e.stopPropagation();
    
    clearTimeout(this.dragTimer);
    
    // Si ce n'était pas un drag, c'est un clic
    if (!this.isDragging && !this.touchMoved) {
      const touchDuration = Date.now() - this.touchStartTime;
      
      // Si le touch était court (< 300ms), c'est un clic
      if (touchDuration < 300) {
        this.toggleWindow();
      }
    }
    
    // Nettoyer l'état de drag
    if (this.isDragging) {
      this.isDragging = false;
      this.button.classList.remove('cursor-grabbing', 'scale-105');
      
      // Animation de retour
      this.button.classList.add('scale-95');
      setTimeout(() => {
        this.button.classList.remove('scale-95');
      }, 200);
    }
    
    // Réinitialiser
    this.touchMoved = false;
  },
  
  // Ouvrir/fermer la fenêtre
  toggleWindow: function() {
    if (this.isOpen) {
      this.closeWindow();
    } else {
      this.openWindow();
    }
  },
  
  // Ouvrir la fenêtre
  openWindow: function() {
    this.window.classList.remove('opacity-0', 'invisible', 'translate-y-2');
    this.window.classList.add('opacity-100', 'visible', 'translate-y-0');
    this.icon.classList.remove('fa-compass');
    this.icon.classList.add('fa-times');
    this.button.setAttribute('aria-expanded', 'true');
    this.isOpen = true;
    
    // Animation de micro-interaction
    this.button.classList.add('scale-110');
    setTimeout(() => {
      this.button.classList.remove('scale-110');
    }, 300);
  },
  
  // Fermer la fenêtre
  closeWindow: function() {
    this.window.classList.remove('opacity-100', 'visible', 'translate-y-0');
    this.window.classList.add('opacity-0', 'invisible', 'translate-y-2');
    this.icon.classList.remove('fa-times');
    this.icon.classList.add('fa-compass');
    this.button.setAttribute('aria-expanded', 'false');
    this.isOpen = false;
  },
  
  // Position initiale de la bulle
  positionBulleOnLoad: function() {
    // Position par défaut en bas à droite
    this.container.style.bottom = '20px';
    this.container.style.right = '20px';
  },
  
  // Ajuster la position lors du redimensionnement
  adjustPositionOnResize: function() {
    const rect = this.container.getBoundingClientRect();
    const windowWidth = window.innerWidth;
    const windowHeight = window.innerHeight;
    
    // S'assurer que la bulle reste dans les limites de la fenêtre
    if (rect.left < 0) {
      this.container.style.left = '10px';
      this.container.style.right = 'auto';
    }
    
    if (rect.top < 0) {
      this.container.style.top = '10px';
      this.container.style.bottom = 'auto';
    }
    
    if (rect.right > windowWidth) {
      this.container.style.right = '10px';
      this.container.style.left = 'auto';
    }
    
    if (rect.bottom > windowHeight) {
      this.container.style.bottom = '10px';
      this.container.style.top = 'auto';
    }
  },
  
  // Début du drag (souris) - pour desktop
  startDrag: function(e) {
    e.preventDefault();
    this.isDragging = true;
    this.startX = e.clientX;
    this.startY = e.clientY;
    
    // Enregistrer la position initiale
    const rect = this.container.getBoundingClientRect();
    this.initialX = rect.left;
    this.initialY = rect.top;
    
    // Changer l'apparence pendant le drag
    this.button.classList.add('cursor-grabbing', 'scale-105');
  },
  
  // Déplacement (souris) - pour desktop
  drag: function(e) {
    if (!this.isDragging) return;
    
    e.preventDefault();
    
    // Calculer le déplacement
    const deltaX = e.clientX - this.startX;
    const deltaY = e.clientY - this.startY;
    
    // Calculer la nouvelle position
    let newX = this.initialX + deltaX;
    let newY = this.initialY + deltaY;
    
    // Limites de la fenêtre
    const windowWidth = window.innerWidth;
    const windowHeight = window.innerHeight;
    const buttonSize = 56; // w-14 = 56px
    
    // S'assurer que la bulle reste dans les limites
    newX = Math.max(0, Math.min(newX, windowWidth - buttonSize));
    newY = Math.max(0, Math.min(newY, windowHeight - buttonSize));
    
    // Appliquer la nouvelle position
    this.container.style.left = `${newX}px`;
    this.container.style.top = `${newY}px`;
    this.container.style.right = 'auto';
    this.container.style.bottom = 'auto';
    
    // Fermer la fenêtre si elle est ouverte pendant le drag
    if (this.isOpen) {
      this.closeWindow();
    }
  },
  
  // Fin du drag (souris) - pour desktop
  stopDrag: function() {
    if (!this.isDragging) return;
    
    this.isDragging = false;
    this.button.classList.remove('cursor-grabbing', 'scale-105');
    
    // Animation de retour
    this.button.classList.add('scale-95');
    setTimeout(() => {
      this.button.classList.remove('scale-95');
    }, 200);
  }
};

// Initialiser la bulle de navigation quand le DOM est chargé
document.addEventListener('DOMContentLoaded', () => {
  navBulleConfig.init();
});
</script>

<!-- Styles additionnels pour une meilleure expérience mobile -->
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

* {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
}

#navBulleContainer {
  touch-action: none; /* Empêche le défilement pendant le drag sur mobile */
}

#navBulleBtn {
  cursor: grab;
  box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
}

#navBulleBtn:active {
  cursor: grabbing;
}

#navBulleWindow {
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
  border: 1px solid rgba(255, 255, 255, 0.2);
  background-color: white; /* Assure un fond blanc */
}

/* Correction des couleurs des textes et liens */
#navBulleWindow h2 {
  color: #1f2937 !important; /* Couleur foncée pour le titre */
}

#navBulleLinks a {
  color: #374151 !important; /* Couleur gris foncé pour les liens */
}

#navBulleLinks a span {
  color: #374151 !important; /* Assure la couleur du texte des liens */
}

#navBulleCloseBtn {
  color: #6b7280 !important; /* Couleur grise pour l'icône de fermeture */
}

#navBulleCloseBtn:hover {
  color: #374151 !important;
}

/* Animation d'entrée pour les liens */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

#navBulleLinks li {
  animation: fadeInUp 0.3s ease-out forwards;
  opacity: 0;
}

#navBulleLinks li:nth-child(1) { animation-delay: 0.05s; }
#navBulleLinks li:nth-child(2) { animation-delay: 0.1s; }
#navBulleLinks li:nth-child(3) { animation-delay: 0.15s; }
#navBulleLinks li:nth-child(4) { animation-delay: 0.2s; }
#navBulleLinks li:nth-child(5) { animation-delay: 0.25s; }
#navBulleLinks li:nth-child(6) { animation-delay: 0.3s; }

/* Assurer la visibilité des icônes dans les cercles colorés */
#navBulleLinks a div i {
  color: inherit !important; /* Hérite la couleur définie par la classe */
}

/* Responsive adjustments */
@media (max-width: 640px) {
  #navBulleWindow {
    width: calc(100vw - 40px);
    max-width: 300px;
    right: 0;
    bottom: 70px;
  }
  
  #navBulleWindow > div:last-child {
    right: 20px;
  }
}

/* Dark mode support - corrigé pour garder la lisibilité */
@media (prefers-color-scheme: dark) {
  #navBulleWindow {
    background-color: #1f2937 !important;
    border-color: #374151 !important;
  }
  
  #navBulleWindow h2 {
    color: #f9fafb !important; /* Blanc pour le titre en dark mode */
  }
  
  #navBulleLinks a {
    color: #e5e7eb !important; /* Gris clair pour les liens */
  }
  
  #navBulleLinks a span {
    color: #e5e7eb !important; /* Gris clair pour le texte */
  }
  
  #navBulleLinks a:hover {
    background-color: rgba(59, 130, 246, 0.1) !important;
  }
  
  #navBulleCloseBtn {
    color: #9ca3af !important;
  }
  
  #navBulleCloseBtn:hover {
    background-color: #374151 !important;
    color: #f9fafb !important;
  }
  
  #navBulleWindow > div:last-child {
    background-color: #1f2937 !important;
  }
}

/* Force la visibilité des éléments pendant les animations */
#navBulleWindow.opacity-100.visible {
  opacity: 1 !important;
  visibility: visible !important;
}

/* Correction spécifique pour les couleurs des icônes dans les cercles */
.bg-opacity-10 {
  background-color: rgba(59, 130, 246, 0.1) !important;
}

.text-blue-600 { color: #2563eb !important; }
.text-green-600 { color: #16a34a !important; }
.text-purple-600 { color: #9333ea !important; }
.text-amber-600 { color: #d97706 !important; }
.text-red-600 { color: #dc2626 !important; }
.text-indigo-600 { color: #4f46e5 !important; }
</style>

    <!-- Modal de confirmation de suppression -->
    <div id="delete-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-md w-full fade-in">
            <div class="p-6">
                <div class="flex items-center justify-center w-12 h-12 mx-auto bg-red-100 rounded-full mb-4">
                    <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-800 text-center mb-2">
                    Confirmer la suppression
                </h3>
                <p class="text-gray-600 text-center mb-6">
                    Êtes-vous sûr de vouloir supprimer cet article ? Cette action est irréversible.
                </p>
                <div class="flex space-x-3">
                    <button type="button" id="cancel-delete"
                            class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-3 px-4 rounded-lg transition">
                        Annuler
                    </button>
                    <button type="button" id="confirm-delete"
                            class="flex-1 bg-red-600 hover:bg-red-700 text-white font-medium py-3 px-4 rounded-lg transition">
                        Supprimer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // Attendre que Firebase soit chargé
        document.addEventListener('DOMContentLoaded', async () => {
            // Charger header et footer
            await loadComponents();
            
            // Initialiser l'application
            await initializeApp();
            
            // Configurer les écouteurs d'événements
            setupEventListeners();
            
            // Charger les articles
            loadPosts();
        });
        
        /**
         * Charge les composants header et footer
         */
        async function loadComponents() {
            try {
                // Charger le header
                const headerResponse = await fetch('header.html');
                if (headerResponse.ok) {
                    const headerHtml = await headerResponse.text();
                    document.getElementById('header-container').innerHTML = headerHtml;
                }
                
                // Charger le footer
                const footerResponse = await fetch('footer.html');
                if (footerResponse.ok) {
                    const footerHtml = await footerResponse.text();
                    document.getElementById('footer-container').innerHTML = footerHtml;
                }
            } catch (error) {
                console.error('Erreur lors du chargement des composants:', error);
            }
        }
        
        /**
         * Initialise l'application et vérifie l'authentification
         */
        async function initializeApp() {
            try {
                // Vérifier l'authentification
                window.auth.onAuthStateChanged((user) => {
                    if (!user) {
                        // Rediriger vers la page de connexion si non authentifié
                        window.location.href = 'login.html';
                    } else {
                        console.log('Utilisateur authentifié:', user.email);
                    }
                });
            } catch (error) {
                console.error('Erreur lors de l\'initialisation:', error);
                showFeedback('Erreur d\'initialisation. Veuillez recharger la page.', 'error');
            }
        }
        
        /**
         * Configure tous les écouteurs d'événements
         */
        function setupEventListeners() {
            const postForm = document.getElementById('post-form');
            const cancelEditBtn = document.getElementById('cancel-edit-btn');
            const cancelDeleteBtn = document.getElementById('cancel-delete');
            const confirmDeleteBtn = document.getElementById('confirm-delete');
            
            // Soumission du formulaire
            postForm.addEventListener('submit', handleFormSubmit);
            
            // Annulation de l'édition
            cancelEditBtn.addEventListener('click', resetForm);
            
            // Modal de suppression
            cancelDeleteBtn.addEventListener('click', () => {
                document.getElementById('delete-modal').classList.add('hidden');
            });
            
            confirmDeleteBtn.addEventListener('click', handleDeletePost);
        }
        
        /**
         * Gère la soumission du formulaire (ajout ou modification)
         */
        async function handleFormSubmit(event) {
            event.preventDefault();
            
            const submitBtn = document.getElementById('submit-btn');
            const originalText = submitBtn.innerHTML;
            
            try {
                // Désactiver le bouton pendant le traitement
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Traitement...';
                
                // Récupérer les données du formulaire
                const formData = getFormData();
                
                // Valider les données
                if (!validateFormData(formData)) {
                    throw new Error('Veuillez remplir tous les champs obligatoires');
                }
                
                // Vérifier l'authentification
                const user = window.auth.currentUser;
                if (!user) {
                    throw new Error('Vous devez être connecté pour effectuer cette action');
                }
                
                // Préparer les données pour Firestore
                const postData = {
                    authorId: user.uid,
                    type: formData.type,
                    media: formData.media,
                    description: formData.description,
                    createdAt: window.firebaseModules.serverTimestamp(),
                    likesCount: 0,
                    commentsCount: 0
                };
                
                const postId = document.getElementById('post-id').value;
                
                if (postId) {
                    // Mise à jour d'un article existant
                    await updatePost(postId, postData);
                    showFeedback('Article mis à jour avec succès !', 'success');
                } else {
                    // Création d'un nouvel article
                    await createPost(postData);
                    showFeedback('Article publié avec succès !', 'success');
                }
                
                // Réinitialiser le formulaire
                resetForm();
                
            } catch (error) {
                console.error('Erreur lors de la soumission:', error);
                showFeedback(error.message || 'Une erreur est survenue', 'error');
            } finally {
                // Réactiver le bouton
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        }
        
        /**
         * Récupère les données du formulaire
         */
        function getFormData() {
            return {
                type: document.querySelector('input[name="type"]:checked').value,
                media: document.getElementById('media').value.trim(),
                description: document.getElementById('description').value.trim()
            };
        }
        
        /**
         * Valide les données du formulaire
         */
        function validateFormData(data) {
            if (!data.type || !data.media || !data.description) {
                return false;
            }
            
            // Validation basique du nom de fichier
            if (!data.media.includes('.')) {
                showFeedback('Le nom du fichier doit contenir une extension', 'error');
                return false;
            }
            
            return true;
        }
        
        /**
         * Crée un nouvel article dans Firestore
         */
        async function createPost(postData) {
            try {
                const { collection, addDoc } = window.firebaseModules;
                const postsCollection = collection(window.db, 'posts');
                
                await addDoc(postsCollection, postData);
            } catch (error) {
                console.error('Erreur lors de la création:', error);
                throw new Error('Impossible de créer l\'article. Veuillez réessayer.');
            }
        }
        
        /**
         * Met à jour un article existant dans Firestore
         */
        async function updatePost(postId, postData) {
            try {
                const { doc, updateDoc } = window.firebaseModules;
                const postDoc = doc(window.db, 'posts', postId);
                
                // Ne pas mettre à jour le createdAt
                delete postData.createdAt;
                
                await updateDoc(postDoc, postData);
            } catch (error) {
                console.error('Erreur lors de la mise à jour:', error);
                throw new Error('Impossible de mettre à jour l\'article. Veuillez réessayer.');
            }
        }
        
        /**
         * Charge et affiche tous les articles
         */
        function loadPosts() {
            try {
                const { collection, query, orderBy, onSnapshot } = window.firebaseModules;
                const postsCollection = collection(window.db, 'posts');
                
                // Créer une requête triée par date (plus récent en premier)
                const postsQuery = query(postsCollection, orderBy('createdAt', 'desc'));
                
                // Écouter les changements en temps réel
                onSnapshot(postsQuery, (snapshot) => {
                    const posts = [];
                    snapshot.forEach((doc) => {
                        posts.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    renderPosts(posts);
                }, (error) => {
                    console.error('Erreur lors du chargement:', error);
                    showFeedback('Erreur lors du chargement des articles', 'error');
                });
                
            } catch (error) {
                console.error('Erreur lors de l\'initialisation du chargement:', error);
                showFeedback('Impossible de charger les articles', 'error');
            }
        }
        
        /**
         * Affiche la liste des articles
         */
        function renderPosts(posts) {
            const postsList = document.getElementById('posts-list');
            const postsCount = document.getElementById('posts-count');
            
            if (posts.length === 0) {
                postsList.innerHTML = `
                    <div class="p-8 text-center text-gray-500">
                        <i class="fas fa-newspaper text-4xl mb-4 opacity-20"></i>
                        <p class="text-lg">Aucun article publié</p>
                        <p class="text-sm mt-2">Commencez par ajouter votre premier article</p>
                    </div>
                `;
                postsCount.textContent = '0';
                return;
            }
            
            postsCount.textContent = posts.length.toString();
            
            let html = '';
            
            posts.forEach(post => {
                const date = post.createdAt?.toDate() || new Date();
                const formattedDate = formatDate(date);
                
                // Déterminer l'icône selon le type
                const mediaIcon = post.type === 'video' 
                    ? '<i class="fas fa-video text-red-500"></i>' 
                    : '<i class="fas fa-image text-blue-500"></i>';
                
                // Tronquer la description pour l'affichage
                const shortDescription = post.description.length > 150 
                    ? post.description.substring(0, 150) + '...' 
                    : post.description;
                
                html += `
                    <div class="p-6 hover:bg-gray-50 transition fade-in" data-post-id="${post.id}">
                        <div class="flex items-start space-x-4">
                            <!-- Icône média -->
                            <div class="flex-shrink-0 w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center">
                                ${mediaIcon}
                            </div>
                            
                            <!-- Contenu -->
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                        ${post.type === 'video' ? 'Vidéo' : 'Image'}
                                    </span>
                                    <span class="text-sm text-gray-500">
                                        <i class="far fa-clock mr-1"></i>${formattedDate}
                                    </span>
                                </div>
                                
                                <p class="text-sm text-gray-600 mb-2 font-medium">
                                    Fichier : <span class="text-gray-800">${post.media}</span>
                                </p>
                                
                                <p class="text-gray-700 mb-3">
                                    ${shortDescription}
                                </p>
                                
                                <!-- Stats -->
                                <div class="flex items-center text-sm text-gray-500 space-x-4">
                                    <span>
                                        <i class="fas fa-heart mr-1 text-red-400"></i>
                                        ${post.likesCount || 0} likes
                                    </span>
                                    <span>
                                        <i class="fas fa-comment mr-1 text-blue-400"></i>
                                        ${post.commentsCount || 0} commentaires
                                    </span>
                                </div>
                            </div>
                            
                            <!-- Actions -->
                            <div class="flex space-x-2">
                                <button type="button" class="edit-btn p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition"
                                        data-post-id="${post.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button type="button" class="delete-btn p-2 text-red-600 hover:bg-red-50 rounded-lg transition"
                                        data-post-id="${post.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            postsList.innerHTML = html;
            
            // Ajouter les écouteurs d'événements aux boutons
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', () => loadPostForEdit(btn.dataset.postId));
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', () => confirmDelete(btn.dataset.postId));
            });
        }
        
        /**
         * Charge un article pour édition
         */
        async function loadPostForEdit(postId) {
            try {
                const { doc, getDoc } = window.firebaseModules;
                const postDoc = doc(window.db, 'posts', postId);
                const postSnapshot = await getDoc(postDoc);
                
                if (!postSnapshot.exists()) {
                    throw new Error('Article non trouvé');
                }
                
                const post = postSnapshot.data();
                
                // Remplir le formulaire
                document.getElementById('post-id').value = postId;
                document.getElementById('media').value = post.media;
                document.getElementById('description').value = post.description;
                
                // Sélectionner le bon type
                document.getElementById(`type-${post.type}`).checked = true;
                
                // Changer le titre du formulaire
                document.getElementById('form-title').textContent = 'Modifier l\'article';
                document.getElementById('submit-btn-text').textContent = 'Mettre à jour';
                
                // Afficher le bouton d'annulation
                document.getElementById('cancel-edit-btn').classList.remove('hidden');
                
                // Faire défiler jusqu'au formulaire
                document.querySelector('#post-form').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
                
            } catch (error) {
                console.error('Erreur lors du chargement pour édition:', error);
                showFeedback('Impossible de charger l\'article pour édition', 'error');
            }
        }
        
        /**
         * Réinitialise le formulaire
         */
        function resetForm() {
            document.getElementById('post-form').reset();
            document.getElementById('post-id').value = '';
            document.getElementById('type-image').checked = true;
            
            document.getElementById('form-title').textContent = 'Ajouter un article';
            document.getElementById('submit-btn-text').textContent = 'Publier l\'article';
            document.getElementById('cancel-edit-btn').classList.add('hidden');
        }
        
        /**
         * Affiche la modal de confirmation de suppression
         */
        function confirmDelete(postId) {
            document.getElementById('delete-modal').classList.remove('hidden');
            document.getElementById('confirm-delete').dataset.postId = postId;
        }
        
        /**
         * Gère la suppression d'un article
         */
        async function handleDeletePost() {
            const postId = document.getElementById('confirm-delete').dataset.postId;
            const modal = document.getElementById('delete-modal');
            
            try {
                // Désactiver les boutons
                document.getElementById('confirm-delete').disabled = true;
                document.getElementById('cancel-delete').disabled = true;
                document.getElementById('confirm-delete').innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Suppression...';
                
                // Supprimer l'article
                await deletePost(postId);
                
                // Fermer la modal
                modal.classList.add('hidden');
                
                // Afficher le feedback
                showFeedback('Article supprimé avec succès', 'success');
                
            } catch (error) {
                console.error('Erreur lors de la suppression:', error);
                showFeedback('Impossible de supprimer l\'article', 'error');
            } finally {
                // Réactiver les boutons
                document.getElementById('confirm-delete').disabled = false;
                document.getElementById('cancel-delete').disabled = false;
                document.getElementById('confirm-delete').innerHTML = 'Supprimer';
                
                // Nettoyer les données
                delete document.getElementById('confirm-delete').dataset.postId;
            }
        }
        
        /**
         * Supprime un article de Firestore
         */
        async function deletePost(postId) {
            try {
                const { doc, deleteDoc } = window.firebaseModules;
                const postDoc = doc(window.db, 'posts', postId);
                
                await deleteDoc(postDoc);
            } catch (error) {
                console.error('Erreur lors de la suppression:', error);
                throw new Error('Impossible de supprimer l\'article. Veuillez réessayer.');
            }
        }
        
        /**
         * Affiche un message de feedback
         */
        function showFeedback(message, type = 'info') {
            const feedbackEl = document.getElementById('feedback-message');
            
            // Définir les classes selon le type
            const classes = {
                success: 'bg-green-100 text-green-800 border border-green-200',
                error: 'bg-red-100 text-red-800 border border-red-200',
                info: 'bg-blue-100 text-blue-800 border border-blue-200'
            };
            
            // Appliquer les classes
            feedbackEl.className = `${classes[type]} mb-6 p-4 rounded-lg fade-in`;
            
            // Icône selon le type
            const icons = {
                success: '<i class="fas fa-check-circle mr-2"></i>',
                error: '<i class="fas fa-exclamation-circle mr-2"></i>',
                info: '<i class="fas fa-info-circle mr-2"></i>'
            };
            
            // Ajouter le contenu
            feedbackEl.innerHTML = `${icons[type]} ${message}`;
            
            // Afficher l'élément
            feedbackEl.classList.remove('hidden');
            
            // Masquer automatiquement après 5 secondes
            setTimeout(() => {
                feedbackEl.classList.add('hidden');
            }, 5000);
        }
        
        /**
         * Formate une date en français
         */
        function formatDate(date) {
            return date.toLocaleDateString('fr-FR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
    </script>
</body>
</html>